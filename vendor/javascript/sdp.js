var r={};var e={};e.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)};e.localCName=e.generateIdentifier();e.splitLines=function(r){return r.trim().split("\n").map((function(r){return r.trim()}))};e.splitSections=function(r){var e=r.split("\nm=");return e.map((function(r,e){return(e>0?"m="+r:r).trim()+"\r\n"}))};e.getDescription=function(r){var t=e.splitSections(r);return t&&t[0]};e.getMediaSections=function(r){var t=e.splitSections(r);t.shift();return t};e.matchPrefix=function(r,t){return e.splitLines(r).filter((function(r){return 0===r.indexOf(t)}))};e.parseCandidate=function(r){var e;e=0===r.indexOf("a=candidate:")?r.substring(12).split(" "):r.substring(10).split(" ");var t={foundation:e[0],component:parseInt(e[1],10),protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]};for(var a=8;a<e.length;a+=2)switch(e[a]){case"raddr":t.relatedAddress=e[a+1];break;case"rport":t.relatedPort=parseInt(e[a+1],10);break;case"tcptype":t.tcpType=e[a+1];break;case"ufrag":t.ufrag=e[a+1];t.usernameFragment=e[a+1];break;default:t[e[a]]=e[a+1];break}return t};e.writeCandidate=function(r){var e=[];e.push(r.foundation);e.push(r.component);e.push(r.protocol.toUpperCase());e.push(r.priority);e.push(r.address||r.ip);e.push(r.port);var t=r.type;e.push("typ");e.push(t);if("host"!==t&&r.relatedAddress&&r.relatedPort){e.push("raddr");e.push(r.relatedAddress);e.push("rport");e.push(r.relatedPort)}if(r.tcpType&&"tcp"===r.protocol.toLowerCase()){e.push("tcptype");e.push(r.tcpType)}if(r.usernameFragment||r.ufrag){e.push("ufrag");e.push(r.usernameFragment||r.ufrag)}return"candidate:"+e.join(" ")};e.parseIceOptions=function(r){return r.substr(14).split(" ")};e.parseRtpMap=function(r){var e=r.substr(9).split(" ");var t={payloadType:parseInt(e.shift(),10)};e=e[0].split("/");t.name=e[0];t.clockRate=parseInt(e[1],10);t.channels=3===e.length?parseInt(e[2],10):1;t.numChannels=t.channels;return t};e.writeRtpMap=function(r){var e=r.payloadType;void 0!==r.preferredPayloadType&&(e=r.preferredPayloadType);var t=r.channels||r.numChannels||1;return"a=rtpmap:"+e+" "+r.name+"/"+r.clockRate+(1!==t?"/"+t:"")+"\r\n"};e.parseExtmap=function(r){var e=r.substr(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1]}};e.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&"sendrecv"!==r.direction?"/"+r.direction:"")+" "+r.uri+"\r\n"};e.parseFmtp=function(r){var e={};var t;var a=r.substr(r.indexOf(" ")+1).split(";");for(var n=0;n<a.length;n++){t=a[n].trim().split("=");e[t[0].trim()]=t[1]}return e};e.writeFmtp=function(r){var e="";var t=r.payloadType;void 0!==r.preferredPayloadType&&(t=r.preferredPayloadType);if(r.parameters&&Object.keys(r.parameters).length){var a=[];Object.keys(r.parameters).forEach((function(e){r.parameters[e]?a.push(e+"="+r.parameters[e]):a.push(e)}));e+="a=fmtp:"+t+" "+a.join(";")+"\r\n"}return e};e.parseRtcpFb=function(r){var e=r.substr(r.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}};e.writeRtcpFb=function(r){var e="";var t=r.payloadType;void 0!==r.preferredPayloadType&&(t=r.preferredPayloadType);r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach((function(r){e+="a=rtcp-fb:"+t+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+"\r\n"}));return e};e.parseSsrcMedia=function(r){var e=r.indexOf(" ");var t={ssrc:parseInt(r.substr(7,e-7),10)};var a=r.indexOf(":",e);if(a>-1){t.attribute=r.substr(e+1,a-e-1);t.value=r.substr(a+1)}else t.attribute=r.substr(e+1);return t};e.parseSsrcGroup=function(r){var e=r.substr(13).split(" ");return{semantics:e.shift(),ssrcs:e.map((function(r){return parseInt(r,10)}))}};e.getMid=function(r){var t=e.matchPrefix(r,"a=mid:")[0];if(t)return t.substr(6)};e.parseFingerprint=function(r){var e=r.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1]}};e.getDtlsParameters=function(r,t){var a=e.matchPrefix(r+t,"a=fingerprint:");return{role:"auto",fingerprints:a.map(e.parseFingerprint)}};e.writeDtlsParameters=function(r,e){var t="a=setup:"+e+"\r\n";r.fingerprints.forEach((function(r){t+="a=fingerprint:"+r.algorithm+" "+r.value+"\r\n"}));return t};e.parseCryptoLine=function(r){var e=r.substr(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}};e.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+("object"===typeof r.keyParams?e.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+"\r\n"};e.parseCryptoKeyParams=function(r){if(0!==r.indexOf("inline:"))return null;var e=r.substr(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}};e.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")};e.getCryptoParameters=function(r,t){var a=e.matchPrefix(r+t,"a=crypto:");return a.map(e.parseCryptoLine)};e.getIceParameters=function(r,t){var a=e.matchPrefix(r+t,"a=ice-ufrag:")[0];var n=e.matchPrefix(r+t,"a=ice-pwd:")[0];return a&&n?{usernameFragment:a.substr(12),password:n.substr(10)}:null};e.writeIceParameters=function(r){return"a=ice-ufrag:"+r.usernameFragment+"\r\n"+"a=ice-pwd:"+r.password+"\r\n"};e.parseRtpParameters=function(r){var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]};var a=e.splitLines(r);var n=a[0].split(" ");for(var s=3;s<n.length;s++){var i=n[s];var p=e.matchPrefix(r,"a=rtpmap:"+i+" ")[0];if(p){var c=e.parseRtpMap(p);var o=e.matchPrefix(r,"a=fmtp:"+i+" ");c.parameters=o.length?e.parseFmtp(o[0]):{};c.rtcpFeedback=e.matchPrefix(r,"a=rtcp-fb:"+i+" ").map(e.parseRtcpFb);t.codecs.push(c);switch(c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase());break;default:break}}}e.matchPrefix(r,"a=extmap:").forEach((function(r){t.headerExtensions.push(e.parseExtmap(r))}));return t};e.writeRtpDescription=function(r,t){var a="";a+="m="+r+" ";a+=t.codecs.length>0?"9":"0";a+=" UDP/TLS/RTP/SAVPF ";a+=t.codecs.map((function(r){return void 0!==r.preferredPayloadType?r.preferredPayloadType:r.payloadType})).join(" ")+"\r\n";a+="c=IN IP4 0.0.0.0\r\n";a+="a=rtcp:9 IN IP4 0.0.0.0\r\n";t.codecs.forEach((function(r){a+=e.writeRtpMap(r);a+=e.writeFmtp(r);a+=e.writeRtcpFb(r)}));var n=0;t.codecs.forEach((function(r){r.maxptime>n&&(n=r.maxptime)}));n>0&&(a+="a=maxptime:"+n+"\r\n");a+="a=rtcp-mux\r\n";t.headerExtensions&&t.headerExtensions.forEach((function(r){a+=e.writeExtmap(r)}));return a};e.parseRtpEncodingParameters=function(r){var t=[];var a=e.parseRtpParameters(r);var n=-1!==a.fecMechanisms.indexOf("RED");var s=-1!==a.fecMechanisms.indexOf("ULPFEC");var i=e.matchPrefix(r,"a=ssrc:").map((function(r){return e.parseSsrcMedia(r)})).filter((function(r){return"cname"===r.attribute}));var p=i.length>0&&i[0].ssrc;var c;var o=e.matchPrefix(r,"a=ssrc-group:FID").map((function(r){var e=r.substr(17).split(" ");return e.map((function(r){return parseInt(r,10)}))}));o.length>0&&o[0].length>1&&o[0][0]===p&&(c=o[0][1]);a.codecs.forEach((function(r){if("RTX"===r.name.toUpperCase()&&r.parameters.apt){var e={ssrc:p,codecPayloadType:parseInt(r.parameters.apt,10)};p&&c&&(e.rtx={ssrc:c});t.push(e);if(n){e=JSON.parse(JSON.stringify(e));e.fec={ssrc:p,mechanism:s?"red+ulpfec":"red"};t.push(e)}}}));0===t.length&&p&&t.push({ssrc:p});var u=e.matchPrefix(r,"b=");if(u.length){u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-50*40*8:void 0;t.forEach((function(r){r.maxBitrate=u}))}return t};e.parseRtcpParameters=function(r){var t={};var a=e.matchPrefix(r,"a=ssrc:").map((function(r){return e.parseSsrcMedia(r)})).filter((function(r){return"cname"===r.attribute}))[0];if(a){t.cname=a.value;t.ssrc=a.ssrc}var n=e.matchPrefix(r,"a=rtcp-rsize");t.reducedSize=n.length>0;t.compound=0===n.length;var s=e.matchPrefix(r,"a=rtcp-mux");t.mux=s.length>0;return t};e.parseMsid=function(r){var t;var a=e.matchPrefix(r,"a=msid:");if(1===a.length){t=a[0].substr(7).split(" ");return{stream:t[0],track:t[1]}}var n=e.matchPrefix(r,"a=ssrc:").map((function(r){return e.parseSsrcMedia(r)})).filter((function(r){return"msid"===r.attribute}));if(n.length>0){t=n[0].value.split(" ");return{stream:t[0],track:t[1]}}};e.parseSctpDescription=function(r){var t=e.parseMLine(r);var a=e.matchPrefix(r,"a=max-message-size:");var n;a.length>0&&(n=parseInt(a[0].substr(19),10));isNaN(n)&&(n=65536);var s=e.matchPrefix(r,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substr(12),10),protocol:t.fmt,maxMessageSize:n};var i=e.matchPrefix(r,"a=sctpmap:");if(i.length>0){var p=e.matchPrefix(r,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:n}}};e.writeSctpDescription=function(r,e){var t=[];t="DTLS/SCTP"!==r.protocol?["m="+r.kind+" 9 "+r.protocol+" "+e.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+e.port+"\r\n"]:["m="+r.kind+" 9 "+r.protocol+" "+e.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+e.port+" "+e.protocol+" 65535\r\n"];void 0!==e.maxMessageSize&&t.push("a=max-message-size:"+e.maxMessageSize+"\r\n");return t.join("")};e.generateSessionId=function(){return Math.random().toString().substr(2,21)};e.writeSessionBoilerplate=function(r,t,a){var n;var s=void 0!==t?t:2;n=r||e.generateSessionId();var i=a||"thisisadapterortc";return"v=0\r\n"+"o="+i+" "+n+" "+s+" IN IP4 127.0.0.1\r\n"+"s=-\r\n"+"t=0 0\r\n"};e.writeMediaSection=function(r,t,a,n){var s=e.writeRtpDescription(r.kind,t);s+=e.writeIceParameters(r.iceGatherer.getLocalParameters());s+=e.writeDtlsParameters(r.dtlsTransport.getLocalParameters(),"offer"===a?"actpass":"active");s+="a=mid:"+r.mid+"\r\n";r.direction?s+="a="+r.direction+"\r\n":r.rtpSender&&r.rtpReceiver?s+="a=sendrecv\r\n":r.rtpSender?s+="a=sendonly\r\n":r.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n";if(r.rtpSender){var i="msid:"+n.id+" "+r.rtpSender.track.id+"\r\n";s+="a="+i;s+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" "+i;if(r.sendEncodingParameters[0].rtx){s+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" "+i;s+="a=ssrc-group:FID "+r.sendEncodingParameters[0].ssrc+" "+r.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}s+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+"\r\n";r.rtpSender&&r.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+"\r\n");return s};e.getDirection=function(r,t){var a=e.splitLines(r);for(var n=0;n<a.length;n++)switch(a[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[n].substr(2);default:}return t?e.getDirection(t):"sendrecv"};e.getKind=function(r){var t=e.splitLines(r);var a=t[0].split(" ");return a[0].substr(2)};e.isRejected=function(r){return"0"===r.split(" ",2)[1]};e.parseMLine=function(r){var t=e.splitLines(r);var a=t[0].substr(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}};e.parseOLine=function(r){var t=e.matchPrefix(r,"o=")[0];var a=t.substr(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}};e.isValidSDP=function(r){if("string"!==typeof r||0===r.length)return false;var t=e.splitLines(r);for(var a=0;a<t.length;a++)if(t[a].length<2||"="!==t[a].charAt(1))return false;return true};r=e;var t=r;export default t;

